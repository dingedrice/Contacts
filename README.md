# Contacts
This tool reads structure based model contact content and calculates the fraction of native contacts (Q) either during an OpenMM simulation or from a simulation trajectory.

OpenMM package (version 7.7 or higher) is required to run the code.

## The `Contacts` class

The `Contacts` class is used to store and manipulate contact information for a system. A contact is defined as an atom pair and the distance between the two atoms.

### Methods

- `getNumContacts(self)`: Returns the number of contacts.
- `getContact(self, index)`: Returns the contact at the specified index.
- `getAtom1Array(self)`: Returns a copy of the array of the first atom indices.
- `getAtom2Array(self)`: Returns a copy of the array of the second atom indices.
- `getDistanceArray(self)`: Returns a copy of the array of distances.
- `rescaledDistances(self, scale)`: Returns the distances rescaled by the specified scale.
- `getIndices(self)`: Returns all the atom index pairs (N x 2).
- `toArray(self)`: Returns an array of atom index pairs and distances (N x 3).
- `addContacts(self, atom1, atom2, distance)`: Adds contacts to the arrays.
- `removeContacts(self, index)`: Removes contacts at the specified index.
- `setContacts(self, index, atom1, atom2, distance)`: Sets the contacts at the specified index.

## The `ContactsOnuchic` class

The `ContactsOnuchic` class is derived from the `Contacts` class and stores the native contact information from structure based models. Further information is available for the definition of native contacts in a biomolecule ([J. Phys. Chem. B 2012, 116 (29), 8692–8702](https://doi.org/10.1021/jp300852d)) and the structure based model ([PLoS Comput Biol 2016, 12 (3), e1004794](https://doi.org/10.1371/journal.pcbi.1004794) and [Protein Science 2022, 31 (1), 158–172](https://doi.org/10.1002/pro.4209)).

The class provides methods to load contacts from OpenMM forces or files.

### Methods

- `loadContacts(self, openmm_forces=None, contacts_file=None, input_distance_calc_dict=None, gro_file=None, array=np.array([]))`: Loads contacts from OpenMM forces or a file. 

    #### Arguments

    - `openmm_forces`: (Optional) OpenMM force(s) containing contact information (CustomBondForce style). Either this argument or `contacts_file` should be provided.
    - `contacts_file`: (Optional) A OpenSMOG XML or GROMACS TOP file containing contact information. When the file is a GROMACS TOP file, only Lennard-Jones potential is supported for distance calculation unless the GRO file is provided. Either this argument or `openmm_forces` should be provided.
    - `input_distance_calc_dict`: (Optional) A python dictionary containing the information for distance calculation. The key should be the energy format in OpenMM style and the value should be the function to calculate the distances from OpenMM forces parameters. Lennard-Jones potential for all-atom structure based model and "10-12" force for C-alpha structure based model are supported by default.
        - e.g. `{'A/r^12-B/r^6': lambda A, B: (2*A/B)**(1/6)}`
    - `gro_file`: (Optional) A GRO file containing the coordinates of the system. When the file is provided, the distances are calculated based on the coordinates in the GRO file. Can not be used with `array`.
    - `array`: (Optional) An array containing the coordinates. Can not be used with `gro_file`.

    #### Example

    ```python
    contacts = ContactsOnuchic()
    contacts.loadContacts(contacts_file='smog.xml') # smog.xml generated by SMOG 2 for OpenSMOG
    ```
    ```python
    contacts = ContactsOnuchic()
    contacts.loadContacts(contacts_file='smog.top') # smog.top generated by SMOG 2 for GROMACS
    ```
    ```python
    contacts = ContactsOnuchic()
    contacts.loadContacts(contacts_file='smog.top', gro_file='smog.gro') # self defined smog.top and native structure smog.gro
    ```

## The `QOnuchicReporter` class

The `QOnuchicReporter` can be applied in an OpenMM simulation to report the fraction of native contacts (Q).

### Arguments

- `reportInterval`: The interval at which to report the fraction of native contacts (Q).
- `contacts`: A `Contacts` object containing all the contacts of the system.
- `cutoff`: The cutoff distance. Within cutoff*original_distance, the contact is considered formed.
- `Qi`: Whether to report the formation of every single contacts (Qi) or only report the fraction of native contacts globally (Q).

## The `qOnuchic` function

The MDTraj package is required for this function since the trajectory is represented as an `md.Trajectory` object.

The `qOnuchic` function calculates the fraction of native contacts (Q) for a given trajectory and contacts.

### Arguments

- `traj`: An `md.Trajectory` object representing the trajectory.
- `contacts`: A `Contacts` object representing the contacts.
- `cutoff`: The cutoff distance. Within cutoff*original_distance, the contact is considered formed.

### Returns

- The fraction of native contacts (Q) for each frame in the trajectory.
